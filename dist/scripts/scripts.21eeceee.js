"use strict";angular.module("services.config",[]).constant("configuration",{apiUrl:"http://quickstart-api.herokuapp.com/",facebookClientId:"791143367623515"}),angular.module("meanApp",["ui.router","ngAnimate","satellizer","services.config"]),angular.module("meanApp").config(["$urlRouterProvider","$stateProvider","$httpProvider","$authProvider","configuration",function(a,b,c,d,e){a.otherwise("/"),b.state("main",{url:"/",templateUrl:"/views/main.html"}).state("register",{url:"/register",templateUrl:"/views/register.html",controller:"RegisterCtrl"}).state("login",{url:"/login",templateUrl:"/views/login.html",controller:"LoginCtrl"}).state("vehicles",{url:"/vehicles",templateUrl:"/views/vehicles.html",controller:"VehiclesCtrl"}).state("logout",{url:"/logout",controller:"LogoutCtrl"}),d.loginUrl=e.apiUrl+"auth/login",d.signupUrl=e.apiUrl+"auth/register",d.google({clientId:"293729951422-1aoar6i6acc23l8lrmb0m2dm9ommefq9.apps.googleusercontent.com",url:e.apiUrl+"auth/google"}),d.facebook({clientId:"'"+e.facebookClientId+"'",url:e.apiUrl+"auth/facebook"}),c.interceptors.push("authInterceptor")}]).run(["$window",function(a){var b=a.location.search.substring(1);if(b&&a.opener&&a.opener.location.origin===a.location.origin){var c=b.split("="),d=decodeURIComponent(c[1]);a.opener.postMessage(d,a.location.origin)}}]),angular.module("meanApp").directive("validateEquals",function(){return{require:"ngModel",link:function(a,b,c,d){function e(b){var e=b===a.$eval(c.validateEquals);return d.$setValidity("equal",e),e?b:void 0}d.$parsers.push(e),d.$formatters.push(e),a.$watch(c.validateEquals,function(){d.$setViewValue(d.$viewValue)})}}}),angular.module("meanApp").controller("RegisterCtrl",["$scope","alert","$auth",function(a,b,c){a.submit=function(){c.signup({email:a.email,password:a.password}).then(function(a){b("success","Account Created","Welcome "+a.data.user.email+"!")})["catch"](function(a){b("warning","Snap!","Something went wrong :(",a.message)})}}]),angular.module("meanApp").service("alert",["$rootScope","$timeout",function(a,b){var c;return function(d,e,f,g){a.alert={hasBeenShown:!0,show:!0,type:d,message:f,title:e},b.cancel(c),c=b(function(){a.alert.show=!1},g||2e3)}}]),angular.module("meanApp").factory("authToken",["$window",function(a){var b,c=a.localStorage,d="userToken",e={setToken:function(a){b=a,c.setItem(d,a)},getToken:function(){return b||(b=c.getItem(d)),b},isAuthenticated:function(){return!!e.getToken()},removeToken:function(){b=null,c.removeItem(d)}};return e}]),angular.module("meanApp").controller("HeaderCtrl",["$scope","$auth",function(a,b){a.isAuthenticated=b.isAuthenticated}]),angular.module("meanApp").controller("LogoutCtrl",["$auth","$state",function(a,b){a.logout(),b.go("main")}]),angular.module("meanApp").controller("VehiclesCtrl",["$scope","$http","configuration","alert",function(a,b,c,d){b.get(c.apiUrl+"vehicles").success(function(b){a.vehicles=b}).error(function(a){d("warning","unable to get vehicles",a.message)})}]),angular.module("meanApp").factory("authInterceptor",["authToken",function(a){return{request:function(b){var c=a.getToken();return c&&(b.headers.Authorization="Bearer "+c),b},response:function(a){return a}}}]),angular.module("meanApp").controller("LoginCtrl",["$scope","alert","$auth",function(a,b,c){function d(a){b("warning","Snap!","Something went wrong :(",a.message)}a.submit=function(){c.login({email:a.email,password:a.password}).then(function(a){b("success","Welcome","Thanks for coming back "+a.data.user.email+"!")})["catch"](d)},a.authenticate=function(a){c.authenticate(a).then(function(a){b("success","Welcome","Thanks for coming back "+a.data.user.displayName+"!")},d)}}]),angular.module("meanApp").service("auth",["$http","configuration","authToken","$state","$window","$q",function(a,b,c,d,e,f){function g(a){c.setToken(a.token),d.go("main")}this.login=function(c,d){return a.post(b.apiUrl+"login",{email:c,password:d}).success(g)},this.register=function(c,d){return a.post(b.apiUrl+"register",{email:c,password:d}).success(g)};var h=[],i="293729951422-1aoar6i6acc23l8lrmb0m2dm9ommefq9.apps.googleusercontent.com";h.push("response_type=code","client_id="+i,"redirect_uri="+window.location.origin,"scope=profile email"),this.googleAuth=function(){var c="https://accounts.google.com/o/oauth2/auth?"+h.join("&"),d="width=500, height=500, left="+(e.outerWidth-500)/2+",top="+(e.outerHeight-500)/2.5,j=f.defer(),k=e.open(c,"",d);return e.focus(),e.addEventListener("message",function(c){if(c.origin===e.location.origin){var d=c.data;k.close(),a.post(b.apiUrl+"auth/google",{code:d,clientId:i,redirectUri:window.location.origin}).success(function(a){g(a),j.resolve(a)})}}),j.promise}}]);